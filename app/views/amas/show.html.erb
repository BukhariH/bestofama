<% content_for :title, @ama.title + " by " + @ama.user.username + " :: BestofAMA" %>

<% cache(@ama) do %>
    <div class="row">
      <div class="span1 ama-karma-meter-large">
        <%= karma_meter(@ama.karma).html_safe %>
      </div>
      <div class="span11">
        <% if @ama.user.entities.count > 0 %>
            <h2>
              <%= @ama.user.entities.group(:id).map! { |e| link_to e.name, entity_path(e) }.join(" & ").html_safe %>
              <small>as <%= link_to @ama.user.username, user_path(@ama.user) %></small>
            </h2>
        <% end %>
        <h5><%= @ama.title.html_safe %></h5>
        <% if !@ama.content.blank? %>
            <div class="well" style="margin-bottom: 5px;"><%= @ama.content.html_safe %></div>
        <% end %>
        <p class="muted">
          <b>Comments:</b> <%= @ama.comments %> | <b>Responses:</b> <%= @ama.responses %> |
          <b>Date:</b> <%= @ama.date %> <%= link_to "source", reddit_ama_path(@ama.permalink), :class => "pull-right" %>
        </p>
      </div>
    </div>

    <% if @ama.users.count > 0 %>
        <div class="row" style="margin-top: 15px;">
          <div class="span12">
            <h4>Participants</h4>
            <ul>
              <% @users.each do |user| %>
                  <li>
                    <% if user.entities.count > 0 %>
                        <h4>
                          <%= user.entities.group(:id).map! { |e| link_to e.name, entity_path(e) }.join(" & ").html_safe %>
                          <small>as <%= link_to user.username, user_path(user) %></small>
                        </h4>
                    <% else %>
                        <%= link_to user.username, user_path(user) %>
                    <% end %>
                  </li>
              <% end %>
            </ul>
          </div>
        </div>
    <% end %>

    <div class="row" style="margin-top: 15px;">
      <div class="span12">
        <h4>Comments</h4>
        <hr/>
        <%= print_comments(@ama, @ama, 0).html_safe %>
      </div>
    </div>
<% end %>

<div id="social-media">

  <!-- Twitter -->
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="BestofAMAs" data-count="vertical">Tweet</a>
  <script>!function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (!d.getElementById(id)) {
          js = d.createElement(s);
          js.id = id;
          js.src = "//platform.twitter.com/widgets.js";
          fjs.parentNode.insertBefore(js, fjs);
      }
  }(document, "script", "twitter-wjs");</script>

  <!-- Facebook -->
  <div class="spacer"></div>
  <div class="fb-like" data-send="false" data-layout="box_count" data-width="50" data-show-faces="true"></div>
  <div id="fb-root"></div>
  <script>(function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- Google Plus -->
  <div class="spacer"></div>
  <div class="g-plusone" data-size="tall"></div>
  <script type="text/javascript">
      (function () {
          var po = document.createElement('script');
          po.type = 'text/javascript';
          po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(po, s);
      })();
  </script>

</div>
